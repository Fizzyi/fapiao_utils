# PyQt6 项目打包成 EXE 文件说明

## 前置要求

1. **操作系统**: 需要在 Windows 系统上打包（macOS 无法直接打包成 exe）
2. **Python 版本**: Python 3.8 或更高版本
3. **安装依赖**: 
   ```bash
   pip install -r requirements.txt
   ```

## 打包步骤

### 步骤 1: 转换图标格式

PyInstaller 需要 ICO 格式的图标，需要先将 SVG 转换为 ICO：

```bash
# 安装图标转换工具
pip install cairosvg pillow

# 运行转换脚本
python convert_icon.py
```

转换完成后会在 `rename_utils/icon.ico` 生成 ICO 文件。

**注意**: 如果没有安装 cairosvg，也可以使用在线工具将 SVG 转换为 ICO：
- https://convertio.co/zh/svg-ico/
- https://cloudconvert.com/svg-to-ico

### 步骤 2: 修复导入路径（如果需要）

检查 `rename_utils/main.py` 第 8 行的导入：
```python
from rename_utils.func import rename_main
```

如果打包时出现导入错误，可能需要改为：
```python
from func import rename_main
```

### 步骤 3: 使用 PyInstaller 打包

#### 方法一：使用 spec 文件（推荐）

```bash
pyinstaller build.spec
```

#### 方法二：直接使用命令行

```bash
pyinstaller --name="发票重命名工具" \
            --icon=rename_utils/icon.ico \
            --windowed \
            --onefile \
            --hidden-import=PyQt6.QtCore \
            --hidden-import=PyQt6.QtWidgets \
            --hidden-import=PyQt6.QtGui \
            --hidden-import=pdfplumber \
            rename_utils/main.py
```

### 步骤 4: 查找生成的 EXE 文件

打包完成后，EXE 文件会在 `dist/` 目录下：
- `dist/发票重命名工具.exe`

## 常见问题

### 1. 打包后的 exe 文件很大

这是正常的，PyInstaller 会打包所有依赖。可以使用 `--exclude-module` 排除不需要的模块。

### 2. 运行时缺少 DLL 文件

确保在 Windows 系统上打包，并且安装了 Visual C++ Redistributable。

### 3. 图标不显示

- 确保 icon.ico 文件存在
- 确保图标文件路径正确
- 尝试重新转换图标文件

### 4. 导入错误

如果出现模块导入错误，可以在 `build.spec` 的 `hiddenimports` 中添加缺失的模块。

## 优化建议

1. **减小文件大小**: 使用 `--exclude-module` 排除不需要的模块
2. **测试**: 在干净的 Windows 系统上测试打包后的 exe
3. **代码签名**: 如果需要分发，考虑对 exe 进行代码签名

## 快速打包命令（一键执行）

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 转换图标
python convert_icon.py

# 3. 打包
pyinstaller build.spec

# 4. 运行测试
dist/发票重命名工具.exe
```

